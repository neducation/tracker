<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>üì± Universal Device Hub</title>
    <style>
      :root {
        --bg: #000000;
        --bg-card: #0a0f15;
        --bg-input: #0d1522;
        --fg: #ffffff;
        --muted: #8a9bb3;
        --accent: #00d4ff;
        --border: #1a2332;
        --border-hover: #2c4367;
      }
      body {
        margin: 0;
        font-family: system-ui, Segoe UI, Roboto, Arial;
        background: var(--bg);
        color: var(--fg);
      }
      header {
        padding: 16px 20px;
        border-bottom: 1px solid #1a2330;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 10px;
      }
      .opacity-control {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 12px;
        color: var(--muted);
      }
      .opacity-slider {
        width: 120px;
        height: 4px;
        background: #1a2330;
        border-radius: 2px;
        outline: none;
        -webkit-appearance: none;
        appearance: none;
      }
      .opacity-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--accent);
        cursor: pointer;
      }
      .opacity-slider::-moz-range-thumb {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--accent);
        cursor: pointer;
        border: none;
      }
      h1 {
        font-size: 18px;
        margin: 0;
        letter-spacing: 0.5px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 12px;
        padding: 16px;
        max-width: 1600px;
        margin: 0 auto;
      }

      @media (max-width: 768px) {
        .grid {
          grid-template-columns: 1fr;
          padding: 10px;
        }
        .opacity-control {
          flex-direction: column;
          gap: 5px;
        }
        .opacity-slider {
          width: 100px;
        }
      }

      @media (min-width: 1200px) {
        .grid {
          grid-template-columns: repeat(5, 1fr);
        }
      }

      @media (min-width: 1600px) {
        .grid {
          grid-template-columns: repeat(6, 1fr);
        }
      }
      .card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.3) inset;
      }
      .card h2 {
        margin: 0 0 10px;
        font-size: 14px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.6px;
      }
      .btn {
        display: inline-block;
        width: 100%;
        padding: 10px 12px;
        margin: 4px 0;
        text-decoration: none;
        text-align: center;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: var(--bg-card);
        color: var(--fg);
        cursor: pointer;
        transition: border-color 0.2s ease, background-color 0.2s ease;
        font-size: 13px;
        font-weight: 500;
        touch-action: manipulation;
        user-select: none;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .btn:hover,
      .btn:focus {
        border-color: var(--border-hover);
        background: #121b26;
        outline: none;
      }
      .btn:active {
        transform: scale(0.98);
        background: #0a1219;
      }
      .btn.accent {
        border-color: var(--accent);
        background: linear-gradient(135deg, #0a1b2b, #0b2539);
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        color: var(--accent);
        font-weight: 600;
      }
      .btn.accent:hover,
      .btn.accent:focus {
        box-shadow: 0 0 25px rgba(0, 212, 255, 0.3);
        border-color: #00c4ef;
        transform: translateY(-1px);
      }
      .row {
        display: flex;
        gap: 8px;
      }
      input[type="text"],
      input[type="tel"],
      input[type="email"],
      input[type="url"],
      input[type="datetime-local"] {
        width: 100%;
        padding: 10px 12px;
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: 10px;
        color: var(--fg);
      }
      input[type="text"]:focus,
      input[type="tel"]:focus,
      input[type="email"]:focus,
      input[type="url"]:focus,
      input[type="datetime-local"]:focus {
        outline: none;
        border-color: var(--accent);
      }
      video {
        width: 100%;
        border-radius: 12px;
        background: black;
      }
      small {
        color: #93a4bd;
        display: block;
        margin-top: 6px;
      }
      footer {
        padding: 10px 16px;
        font-size: 12px;
        color: #93a4bd;
      }

      /* Live Search Results Styles */
      .live-result {
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px;
        margin: 6px 0;
        cursor: pointer;
        transition: background-color 0.2s ease, border-color 0.2s ease;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .live-result:hover {
        background: #121b26;
        border-color: var(--border-hover);
      }
      .live-result .result-icon {
        font-size: 18px;
        min-width: 24px;
      }
      .live-result .result-text {
        flex: 1;
        font-size: 14px;
      }
      .live-result .result-type {
        font-size: 11px;
        color: var(--muted);
        background: var(--bg-card);
        padding: 2px 6px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>üì± Universal Device Hub</h1>
      <div class="opacity-control">
        <span>Button Opacity:</span>
        <input
          type="range"
          class="opacity-slider"
          id="opacitySlider"
          min="10"
          max="100"
          value="100"
        />
        <span id="opacityValue">100%</span>
      </div>
    </header>

    <div class="grid">
      <!-- Live Search & Type Box -->
      <div class="card">
        <h2>üî§ Live Search & Type</h2>
        <input
          id="liveSearch"
          type="text"
          placeholder="Type anything... (google.com, phone numbers, etc.)"
          autocomplete="off"
          style="font-size: 16px; padding: 14px"
        />
        <div
          id="liveResults"
          style="margin-top: 10px; max-height: 200px; overflow-y: auto"
        >
          <!-- Live results will appear here -->
        </div>
        <small
          >Start typing to see live suggestions. Click any result to open/use
          it.</small
        >
      </div>

      <!-- Communications (prefilled) -->
      <div class="card">
        <h2>Communications (Prefilled)</h2>
        <div class="row">
          <input id="phone" type="tel" value="+13052095064" />
          <button class="btn" onclick="dial()">Call</button>
        </div>
        <div class="row">
          <input id="sms" type="tel" value="+13052095064" />
          <button class="btn" onclick="textSms()">SMS</button>
        </div>
        <div class="row">
          <input id="email" type="email" value="70sieves_bluff@icloud.com" />
          <button class="btn" onclick="mail()">Email</button>
        </div>

        <!-- One-tap quick actions -->
        <a class="btn accent" href="tel:+13052095064"
          >üìû Call +1 305-209-5064</a
        >
        <a class="btn" href="sms:+13052095064">üí¨ SMS +1 305-209-5064</a>
        <a class="btn" href="mailto:70sieves_bluff@icloud.com?subject=Hello"
          >‚úâÔ∏è Email 70sieves_bluff@icloud.com</a
        >
        <a
          class="btn"
          href="https://wa.me/13052095064?text=Hello"
          target="_blank"
          rel="noopener"
          >üü¢ WhatsApp +1 305-209-5064</a
        >
        <!-- Optional FaceTime (iOS) -->
        <a class="btn" href="facetime://+13052095064">üé• FaceTime (iOS)</a>
        <small
          >App-specific links (FaceTime/WhatsApp) require the app and browser
          support.</small
        >
      </div>

      <!-- Maps -->
      <div class="card">
        <h2>Maps & Directions</h2>
        <div class="row">
          <input id="query" type="text" placeholder="Search (e.g., coffee)" />
          <button class="btn" onclick="openMapsSearch()">Search</button>
        </div>
        <div class="row">
          <input
            id="dest"
            type="text"
            placeholder="Destination (address or lat,lng)"
          />
          <button class="btn" onclick="openDirections()">Directions</button>
        </div>
        <a class="btn" href="#" onclick="openMyLocation(event)"
          >Open My Location</a
        >
      </div>

      <!-- Camera / Upload -->
      <div class="card">
        <h2>Camera & Upload</h2>
        <input
          id="fileCam"
          type="file"
          accept="image/*"
          capture
          style="display: none"
        />
        <button
          class="btn accent"
          onclick="document.getElementById('fileCam').click()"
        >
          Open Camera (Capture)
        </button>
        <input
          id="filePick"
          type="file"
          accept="image/*"
          style="display: none"
        />
        <button
          class="btn"
          onclick="document.getElementById('filePick').click()"
        >
          Pick Photo / File
        </button>
        <button class="btn" onclick="startPreview()">
          Live Camera Preview
        </button>
        <button class="btn" onclick="stopPreview()">Stop Preview</button>
        <video id="preview" playsinline muted></video>
        <button class="btn" onclick="toggleTorch()">
          Try Flashlight (Android only)
        </button>
        <small
          >Live preview requires HTTPS + user gesture. Torch works only on some
          Android devices.</small
        >
      </div>

      <!-- Device Utilities -->
      <div class="card">
        <h2>Device Utilities</h2>
        <button class="btn accent" onclick="openBrowser()">
          üåê Open Browser
        </button>
        <button class="btn" onclick="openPhotos()">üì∏ Open Photos App</button>
        <button class="btn" onclick="openFileManager()">üìÅ File Manager</button>
        <button class="btn" onclick="openSettings()">‚öôÔ∏è Settings App</button>
        <button class="btn" onclick="openCalculator()">üßÆ Calculator</button>
        <button class="btn" onclick="openNotes()">üìù Notes App</button>
        <button class="btn" onclick="openClock()">‚è∞ Clock/Timer</button>
        <button class="btn" onclick="openContacts()">üë• Contacts</button>
        <small
          >App shortcuts work best on mobile devices with the respective apps
          installed.</small
        >
      </div>

      <!-- Media & Hardware Controls -->
      <div class="card">
        <h2>Media & Hardware</h2>
        <div class="row">
          <button class="btn" onclick="volumeUp()">üîä Volume Up</button>
          <button class="btn" onclick="volumeDown()">üîâ Volume Down</button>
        </div>
        <button class="btn" onclick="getBatteryInfo()">üîã Battery Info</button>
        <button class="btn" onclick="getNetworkInfo()">üì∂ Network Info</button>
        <button class="btn" onclick="getDeviceInfo()">üì± Device Info</button>
        <button class="btn" onclick="orientationInfo()">
          üìê Orientation Info
        </button>
        <button class="btn" onclick="lockOrientation('portrait')">
          üì± Lock Portrait
        </button>
        <button class="btn" onclick="lockOrientation('landscape')">
          üì± Lock Landscape
        </button>
        <button class="btn" onclick="unlockOrientation()">
          üîÑ Unlock Orientation
        </button>
        <div
          id="deviceInfoDisplay"
          style="
            margin-top: 10px;
            padding: 10px;
            background: var(--bg-input);
            border-radius: 8px;
            font-size: 12px;
            display: none;
          "
        ></div>
        <small
          >Hardware controls depend on browser and device capabilities.</small
        >
      </div>

      <!-- Web Utilities & Shortcuts -->
      <div class="card">
        <h2>Web Utilities</h2>
        <div class="row">
          <input id="qrText" type="text" placeholder="Text for QR code" />
          <button class="btn" onclick="generateQR()">üì± Generate QR</button>
        </div>
        <button class="btn" onclick="scanQR()">üì∑ Scan QR Code</button>
        <div class="row">
          <input id="longUrl" type="url" placeholder="URL to shorten" />
          <button class="btn" onclick="shortenUrl()">üîó Shorten URL</button>
        </div>
        <button class="btn" onclick="takeScreenshot()">üì∏ Screenshot</button>
        <button class="btn" onclick="downloadManager()">üì• Downloads</button>
        <button class="btn" onclick="openDevTools()">üîß Dev Tools</button>
        <button class="btn" onclick="viewSource()">üìÑ View Source</button>
        <div
          id="qrDisplay"
          style="margin-top: 10px; text-align: center; display: none"
        ></div>
        <small
          >Some features may require permissions or specific browser
          support.</small
        >
      </div>

      <!-- Share / Utilities -->
      <div class="card">
        <h2>Share & Utilities</h2>
        <button class="btn" onclick="share()">üì§ Native Share</button>
        <div class="row">
          <input id="clip" type="text" placeholder="Text to copy" />
          <button class="btn" onclick="copyText()">üìã Copy</button>
        </div>
        <button class="btn" onclick="vibrate()">üì≥ Vibrate (Android)</button>
        <button class="btn" onclick="wakeLock()">‚òÄÔ∏è Keep Screen Awake</button>
        <button class="btn" onclick="releaseWakeLock()">
          üåô Release Wake Lock
        </button>
        <button class="btn" onclick="goFullscreen()">üî≥ Fullscreen</button>
        <button class="btn" onclick="window.print()">üñ®Ô∏è Print</button>
      </div>

      <!-- Calendar -->
      <div class="card">
        <h2>Calendar (ICS)</h2>
        <input id="title" type="text" value="Quick Event" />
        <input id="whenStart" type="datetime-local" />
        <input id="whenEnd" type="datetime-local" />
        <button class="btn" onclick="downloadICS()">Add to Calendar</button>
      </div>

      <!-- System Tools -->
      <div class="card">
        <h2>‚öôÔ∏è System Tools</h2>
        <button class="btn accent" onclick="location.reload()">
          üîÑ Refresh Page
        </button>
        <button class="btn" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
        <button class="btn" onclick="exportSettings()">
          üì§ Export Settings
        </button>
        <button class="btn" onclick="importSettings()">
          üì• Import Settings
        </button>
        <div class="row">
          <input id="navUrl" type="url" placeholder="https://example.com" />
          <button class="btn" onclick="navigateTo()">üåê Navigate</button>
        </div>
        <div class="row">
          <input
            id="autoRefresh"
            type="number"
            placeholder="Minutes"
            min="1"
            max="1440"
          />
          <button class="btn" onclick="setAutoRefresh()">
            ‚è±Ô∏è Auto Refresh
          </button>
        </div>
        <button class="btn" onclick="systemMonitor()">üìä System Monitor</button>
        <button class="btn" onclick="goFullscreen()">üî≥ Fullscreen</button>
        <button class="btn" onclick="emergencyReset()">
          üö® Emergency Reset
        </button>
        <div
          id="monitorDisplay"
          style="
            margin-top: 10px;
            padding: 10px;
            background: var(--bg-input);
            border-radius: 8px;
            font-size: 12px;
            display: none;
          "
        ></div>
        <small>System tools for display management and monitoring</small>
      </div>
    </div>

    <footer>
      Notes: mobile browsers can‚Äôt open Settings/Photos directly. Use the
      camera/picker above.
    </footer>

    <script>
      const TARGET_PHONE = "+13052095064";
      const TARGET_EMAIL = "70sieves_bluff@icloud.com";
      const isIOS =
        /iPad|iPhone|iPod/.test(navigator.userAgent) ||
        (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);

      // Opacity Control
      const opacitySlider = document.getElementById("opacitySlider");
      const opacityValue = document.getElementById("opacityValue");

      function updateButtonOpacity() {
        const opacity = opacitySlider.value / 100;
        opacityValue.textContent = opacitySlider.value + "%";
        const buttons = document.querySelectorAll(".btn");
        buttons.forEach((btn) => {
          btn.style.opacity = opacity;
        });
        // Save preference
        localStorage.setItem("buttonOpacity", opacitySlider.value);
      }

      // Load saved opacity preference
      const savedOpacity = localStorage.getItem("buttonOpacity") || "100";
      opacitySlider.value = savedOpacity;

      opacitySlider.addEventListener("input", updateButtonOpacity);

      // Initialize opacity on page load
      document.addEventListener("DOMContentLoaded", updateButtonOpacity);

      // Live Search Functionality
      const liveSearchInput = document.getElementById("liveSearch");
      const liveResultsDiv = document.getElementById("liveResults");

      function createResultItem(icon, text, type, action) {
        const result = document.createElement("div");
        result.className = "live-result";
        result.innerHTML = `
          <span class="result-icon">${icon}</span>
          <span class="result-text">${text}</span>
          <span class="result-type">${type}</span>
        `;
        result.onclick = action;
        return result;
      }

      function updateLiveResults() {
        const query = liveSearchInput.value.trim().toLowerCase();
        liveResultsDiv.innerHTML = "";

        if (!query) {
          liveResultsDiv.innerHTML =
            '<div style="text-align: center; color: var(--muted); padding: 20px;">Start typing to see suggestions...</div>';
          return;
        }

        const results = [];

        // URL Detection
        if (
          query.includes(".") &&
          (query.startsWith("http") || !query.includes(" "))
        ) {
          const url = query.startsWith("http") ? query : "https://" + query;
          results.push(
            createResultItem("üåê", `Open: ${url}`, "Website", () =>
              window.open(url, "_blank")
            )
          );
        }

        // Email Detection
        if (query.includes("@") || query.includes("email")) {
          const email = query.includes("@") ? query : TARGET_EMAIL;
          results.push(
            createResultItem(
              "‚úâÔ∏è",
              `Email: ${email}`,
              "Email",
              () => (window.location.href = `mailto:${email}`)
            )
          );
        }

        // Phone Number Detection
        const phoneRegex = /[\d\s\-\(\)\+]{7,}/;
        if (
          phoneRegex.test(query) ||
          query.includes("call") ||
          query.includes("phone")
        ) {
          const phone = phoneRegex.test(query)
            ? query.replace(/[^\d\+]/g, "")
            : TARGET_PHONE;
          results.push(
            createResultItem(
              "üìû",
              `Call: ${phone}`,
              "Phone",
              () => (window.location.href = `tel:${phone}`)
            )
          );
          results.push(
            createResultItem(
              "üí¨",
              `SMS: ${phone}`,
              "SMS",
              () => (window.location.href = `sms:${phone}`)
            )
          );
        }

        // Google Search
        if (query.length > 2) {
          results.push(
            createResultItem("üîç", `Search Google: "${query}"`, "Search", () =>
              window.open(
                `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                "_blank"
              )
            )
          );
        }

        // YouTube Search
        if (
          query.includes("video") ||
          query.includes("youtube") ||
          query.includes("watch")
        ) {
          results.push(
            createResultItem("üì∫", `Search YouTube: "${query}"`, "Video", () =>
              window.open(
                `https://www.youtube.com/results?search_query=${encodeURIComponent(
                  query
                )}`,
                "_blank"
              )
            )
          );
        }

        // Maps/Directions
        if (
          query.includes("map") ||
          query.includes("direction") ||
          query.includes("navigate")
        ) {
          results.push(
            createResultItem("üó∫Ô∏è", `Maps: "${query}"`, "Navigation", () =>
              window.open(
                `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
                  query
                )}`,
                "_blank"
              )
            )
          );
        }

        // Wikipedia
        if (query.includes("wiki") || query.length > 3) {
          results.push(
            createResultItem("üìö", `Wikipedia: "${query}"`, "Reference", () =>
              window.open(
                `https://en.wikipedia.org/wiki/${encodeURIComponent(query)}`,
                "_blank"
              )
            )
          );
        }

        // Shopping
        if (
          query.includes("buy") ||
          query.includes("shop") ||
          query.includes("amazon")
        ) {
          results.push(
            createResultItem("üõí", `Shop: "${query}"`, "Shopping", () =>
              window.open(
                `https://www.amazon.com/s?k=${encodeURIComponent(query)}`,
                "_blank"
              )
            )
          );
        }

        // News
        if (query.includes("news") || query.includes("breaking")) {
          results.push(
            createResultItem("üì∞", `News: "${query}"`, "News", () =>
              window.open(
                `https://news.google.com/search?q=${encodeURIComponent(query)}`,
                "_blank"
              )
            )
          );
        }

        // Copy to clipboard
        results.push(
          createResultItem("üìã", `Copy: "${query}"`, "Clipboard", async () => {
            try {
              await navigator.clipboard.writeText(query);
              alert("Copied to clipboard!");
            } catch (e) {
              alert("Copy failed: " + e.message);
            }
          })
        );

        // QR Code generation
        if (query.length > 0) {
          results.push(
            createResultItem("üì±", `Generate QR: "${query}"`, "QR Code", () => {
              document.getElementById("qrText").value = query;
              generateQR();
              // Scroll to QR section
              document
                .getElementById("qrDisplay")
                .scrollIntoView({ behavior: "smooth" });
            })
          );
        }

        // Display results
        if (results.length === 0) {
          liveResultsDiv.innerHTML =
            '<div style="text-align: center; color: var(--muted); padding: 20px;">No suggestions found</div>';
        } else {
          results.forEach((result) => liveResultsDiv.appendChild(result));
        }
      }

      // Add event listener for live search
      liveSearchInput.addEventListener("input", updateLiveResults);

      // Initialize with placeholder text
      updateLiveResults();

      function dial() {
        const v = (
          document.getElementById("phone").value || TARGET_PHONE
        ).trim();
        location.href = "tel:" + encodeURIComponent(v);
      }
      function textSms() {
        const v = (document.getElementById("sms").value || TARGET_PHONE).trim();
        location.href = "sms:" + encodeURIComponent(v);
      }
      function mail() {
        const v = (
          document.getElementById("email").value || TARGET_EMAIL
        ).trim();
        location.href = "mailto:" + encodeURIComponent(v);
      }

      function appleMapsUrl(q) {
        return "maps://?q=" + encodeURIComponent(q);
      }
      function googleMapsSearch(q) {
        return (
          "https://www.google.com/maps/search/?api=1&query=" +
          encodeURIComponent(q)
        );
      }
      function googleMapsDir(dest) {
        return (
          "https://www.google.com/maps/dir/?api=1&destination=" +
          encodeURIComponent(dest)
        );
      }

      function openMapsSearch() {
        const q = document.getElementById("query").value.trim() || "coffee";
        location.href = isIOS ? appleMapsUrl(q) : googleMapsSearch(q);
      }
      function openDirections() {
        const d = document.getElementById("dest").value.trim();
        if (!d) return alert("Enter destination (address or lat,lng)");
        location.href = googleMapsDir(d);
      }
      function openMyLocation(e) {
        e.preventDefault();
        if (!navigator.geolocation) {
          alert("Geolocation not supported");
          return;
        }
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude } = pos.coords;
            location.href = googleMapsSearch(`${latitude},${longitude}`);
          },
          (err) => alert("Location error: " + err.message)
        );
      }

      let stream, track;
      async function startPreview() {
        try {
          stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" },
            audio: false,
          });
          const vid = document.getElementById("preview");
          vid.srcObject = stream;
          vid.play();
          track = stream.getVideoTracks()[0];
        } catch (e) {
          alert("Camera error: " + e.message);
        }
      }
      function stopPreview() {
        const vid = document.getElementById("preview");
        if (stream) {
          stream.getTracks().forEach((t) => t.stop());
          stream = null;
          track = null;
        }
        vid.pause();
        vid.srcObject = null;
      }

      async function toggleTorch() {
        try {
          if (!track) {
            await startPreview();
          }
          if (!track) return;
          const capabilities = track.getCapabilities?.();
          if (capabilities && "torch" in capabilities) {
            const settings = track.getSettings?.() || {};
            const on = !settings.torch;
            await track.applyConstraints({ advanced: [{ torch: on }] });
            alert("Torch " + (on ? "ON" : "OFF") + " (if supported)");
          } else {
            alert("Torch not supported on this device/browser");
          }
        } catch (e) {
          alert("Torch error: " + e.message);
        }
      }

      async function share() {
        try {
          if (navigator.share) {
            await navigator.share({
              title: "Phone Hub",
              text: "Quick tools",
              url: location.href,
            });
          } else {
            alert("Web Share API not supported");
          }
        } catch (e) {}
      }

      async function copyText() {
        const v = document.getElementById("clip").value;
        try {
          await navigator.clipboard.writeText(v);
          alert("Copied");
        } catch (e) {
          alert("Clipboard not available: " + e.message);
        }
      }

      let wakeLockSentinel = null;
      async function wakeLock() {
        try {
          if ("wakeLock" in navigator) {
            wakeLockSentinel = await navigator.wakeLock.request("screen");
            wakeLockSentinel.addEventListener("release", () =>
              console.log("Wake lock released")
            );
            alert("Screen will stay awake");
          } else {
            alert("Wake Lock not supported");
          }
        } catch (e) {
          alert("Wake Lock error: " + e.message);
        }
      }
      async function releaseWakeLock() {
        try {
          await wakeLockSentinel?.release();
          wakeLockSentinel = null;
          alert("Wake Lock released");
        } catch (e) {}
      }

      function goFullscreen() {
        const el = document.documentElement;
        const req =
          el.requestFullscreen ||
          el.webkitRequestFullscreen ||
          el.msRequestFullscreen;
        if (req) req.call(el);
      }
      function vibrate() {
        if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
        else alert("Vibrate not supported");
      }

      function navigateTo() {
        const u = document.getElementById("navUrl").value.trim();
        if (u) location.href = u;
      }

      // Device Utility Functions
      function openBrowser() {
        // Try different browser apps
        const browserUrls = [
          "googlechrome://",
          "firefox://",
          "safari://",
          "microsoft-edge://",
          "https://www.google.com",
        ];

        // Try app schemes first, fallback to web
        for (let url of browserUrls) {
          try {
            window.open(url, "_blank");
            break;
          } catch (e) {
            continue;
          }
        }
      }

      function openPhotos() {
        // Try platform-specific photo apps
        if (isIOS) {
          location.href = "photos-redirect://";
        } else {
          // Android
          const intent =
            "intent://gallery#Intent;scheme=content;type=image/*;package=com.google.android.apps.photos;end";
          try {
            location.href = intent;
          } catch (e) {
            // Fallback to generic gallery
            location.href = "content://media/external/images/media";
          }
        }
      }

      function openFileManager() {
        if (isIOS) {
          location.href = "shareddocuments://";
        } else {
          // Android file manager intents
          const fileIntents = [
            "intent://files#Intent;package=com.google.android.documentsui;end",
            "intent://files#Intent;package=com.android.documentsui;end",
            "content://com.android.externalstorage.documents/",
          ];

          for (let intent of fileIntents) {
            try {
              location.href = intent;
              break;
            } catch (e) {
              continue;
            }
          }
        }
      }

      function openSettings() {
        if (isIOS) {
          location.href = "App-Prefs://";
        } else {
          // Android settings
          location.href =
            "intent://settings#Intent;action=android.settings.SETTINGS;end";
        }
      }

      function openCalculator() {
        const calcUrls = isIOS
          ? ["calc://"]
          : [
              "intent://calculator#Intent;package=com.google.android.calculator;end",
            ];

        for (let url of calcUrls) {
          try {
            location.href = url;
            break;
          } catch (e) {
            continue;
          }
        }
      }

      function openNotes() {
        if (isIOS) {
          location.href = "mobilenotes://";
        } else {
          location.href =
            "intent://notes#Intent;package=com.google.android.keep;end";
        }
      }

      function openClock() {
        if (isIOS) {
          location.href = "clock-worldclock://";
        } else {
          location.href =
            "intent://clock#Intent;package=com.google.android.deskclock;end";
        }
      }

      function openContacts() {
        if (isIOS) {
          location.href = "contacts://";
        } else {
          location.href =
            "intent://contacts#Intent;package=com.google.android.contacts;end";
        }
      }

      // Media & Hardware Control Functions
      function volumeUp() {
        // Web browsers can't directly control system volume
        // But we can provide media session controls
        if ("mediaSession" in navigator) {
          navigator.mediaSession.setActionHandler("volumeup", () => {
            alert("Volume up pressed - handled by system");
          });
        }
        alert(
          "Volume control requires system-level permissions not available in web browsers."
        );
      }

      function volumeDown() {
        if ("mediaSession" in navigator) {
          navigator.mediaSession.setActionHandler("volumedown", () => {
            alert("Volume down pressed - handled by system");
          });
        }
        alert(
          "Volume control requires system-level permissions not available in web browsers."
        );
      }

      async function getBatteryInfo() {
        const display = document.getElementById("deviceInfoDisplay");
        display.style.display = "block";

        try {
          if ("getBattery" in navigator) {
            const battery = await navigator.getBattery();
            display.innerHTML = `
              <strong>üîã Battery Info:</strong><br>
              Level: ${Math.round(battery.level * 100)}%<br>
              Charging: ${battery.charging ? "Yes" : "No"}<br>
              Charging Time: ${
                battery.chargingTime === Infinity
                  ? "Unknown"
                  : Math.round(battery.chargingTime / 60) + " min"
              }<br>
              Discharging Time: ${
                battery.dischargingTime === Infinity
                  ? "Unknown"
                  : Math.round(battery.dischargingTime / 60) + " min"
              }
            `;
          } else {
            display.innerHTML =
              "<strong>üîã Battery API not supported on this device/browser</strong>";
          }
        } catch (e) {
          display.innerHTML =
            "<strong>üîã Battery info unavailable: " + e.message + "</strong>";
        }
      }

      function getNetworkInfo() {
        const display = document.getElementById("deviceInfoDisplay");
        display.style.display = "block";

        let info = "<strong>üì∂ Network Info:</strong><br>";
        info += `Online: ${navigator.onLine ? "Yes" : "No"}<br>`;

        if ("connection" in navigator) {
          const conn = navigator.connection;
          info += `Type: ${conn.effectiveType || "Unknown"}<br>`;
          info += `Downlink: ${conn.downlink || "Unknown"} Mbps<br>`;
          info += `RTT: ${conn.rtt || "Unknown"} ms<br>`;
          info += `Save Data: ${conn.saveData ? "Enabled" : "Disabled"}`;
        } else {
          info += "Detailed network info not available";
        }

        display.innerHTML = info;
      }

      function getDeviceInfo() {
        const display = document.getElementById("deviceInfoDisplay");
        display.style.display = "block";

        let info = "<strong>üì± Device Info:</strong><br>";
        info += `User Agent: ${navigator.userAgent.substring(0, 50)}...<br>`;
        info += `Platform: ${navigator.platform}<br>`;
        info += `Language: ${navigator.language}<br>`;
        info += `Screen: ${screen.width}x${screen.height}<br>`;
        info += `Viewport: ${window.innerWidth}x${window.innerHeight}<br>`;
        info += `Device Pixel Ratio: ${window.devicePixelRatio}<br>`;
        info += `Touch Support: ${"ontouchstart" in window ? "Yes" : "No"}<br>`;
        info += `Geolocation: ${
          "geolocation" in navigator ? "Available" : "Not Available"
        }`;

        display.innerHTML = info;
      }

      function orientationInfo() {
        const display = document.getElementById("deviceInfoDisplay");
        display.style.display = "block";

        let info = "<strong>üìê Orientation Info:</strong><br>";

        if (screen.orientation) {
          info += `Orientation: ${screen.orientation.type}<br>`;
          info += `Angle: ${screen.orientation.angle}¬∞`;
        } else if (window.orientation !== undefined) {
          info += `Angle: ${window.orientation}¬∞<br>`;
          let type =
            Math.abs(window.orientation) === 90 ? "landscape" : "portrait";
          info += `Type: ${type}`;
        } else {
          info += "Orientation info not available";
        }

        display.innerHTML = info;
      }

      async function lockOrientation(orientation) {
        try {
          if (screen.orientation && screen.orientation.lock) {
            await screen.orientation.lock(orientation);
            alert(`Screen locked to ${orientation}`);
          } else {
            alert("Screen orientation lock not supported");
          }
        } catch (e) {
          alert("Orientation lock failed: " + e.message);
        }
      }

      function unlockOrientation() {
        try {
          if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock();
            alert("Screen orientation unlocked");
          } else {
            alert("Screen orientation unlock not supported");
          }
        } catch (e) {
          alert("Orientation unlock failed: " + e.message);
        }
      }

      // Web Utilities Functions
      function generateQR() {
        const text =
          document.getElementById("qrText").value || "Hello from Phone Hub!";
        const qrDisplay = document.getElementById("qrDisplay");

        // Using QR Server API to generate QR code
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(
          text
        )}`;

        qrDisplay.innerHTML = `
          <img src="${qrUrl}" alt="QR Code" style="max-width: 200px; border: 1px solid var(--border); border-radius: 8px;">
          <br><small>QR Code for: ${text}</small>
        `;
        qrDisplay.style.display = "block";
      }

      async function scanQR() {
        try {
          if ("BarcodeDetector" in window) {
            const stream = await navigator.mediaDevices.getUserMedia({
              video: { facingMode: "environment" },
            });

            const video = document.createElement("video");
            video.srcObject = stream;
            video.play();

            const barcodeDetector = new BarcodeDetector({
              formats: ["qr_code"],
            });

            const detect = async () => {
              const barcodes = await barcodeDetector.detect(video);
              if (barcodes.length > 0) {
                alert("QR Code detected: " + barcodes[0].rawValue);
                stream.getTracks().forEach((track) => track.stop());
              } else {
                requestAnimationFrame(detect);
              }
            };

            video.addEventListener("loadedmetadata", detect);
          } else {
            alert(
              "QR Code scanning not supported in this browser. Try using your camera app instead."
            );
          }
        } catch (e) {
          alert("Camera access denied or not available: " + e.message);
        }
      }

      function shortenUrl() {
        const url = document.getElementById("longUrl").value;
        if (!url) {
          alert("Please enter a URL to shorten");
          return;
        }

        // Using a simple URL shortener service (note: in production, use a proper service)
        const shortUrl = `https://tinyurl.com/api-create.php?url=${encodeURIComponent(
          url
        )}`;

        fetch(shortUrl)
          .then((response) => response.text())
          .then((result) => {
            if (result.startsWith("http")) {
              document.getElementById("longUrl").value = result;
              alert("URL shortened! Result copied to input field.");
            } else {
              alert("Error shortening URL: " + result);
            }
          })
          .catch((e) => {
            alert("Error shortening URL: " + e.message);
          });
      }

      function takeScreenshot() {
        if ("getDisplayMedia" in navigator.mediaDevices) {
          navigator.mediaDevices
            .getDisplayMedia({ video: true })
            .then((stream) => {
              const video = document.createElement("video");
              video.srcObject = stream;
              video.play();

              video.addEventListener("loadedmetadata", () => {
                const canvas = document.createElement("canvas");
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(video, 0, 0);

                canvas.toBlob((blob) => {
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement("a");
                  a.href = url;
                  a.download = `screenshot-${Date.now()}.png`;
                  a.click();
                  URL.revokeObjectURL(url);
                });

                stream.getTracks().forEach((track) => track.stop());
              });
            })
            .catch((e) => {
              alert("Screenshot failed: " + e.message);
            });
        } else {
          alert("Screen capture not supported in this browser");
        }
      }

      function downloadManager() {
        // Open browser's download page
        const downloadUrls = [
          "chrome://downloads/",
          "about:downloads",
          "edge://downloads/",
          "firefox://downloads",
        ];

        for (let url of downloadUrls) {
          try {
            window.open(url, "_blank");
            break;
          } catch (e) {
            continue;
          }
        }

        alert(
          "Attempting to open download manager. If nothing opens, check your browser's menu."
        );
      }

      function openDevTools() {
        // This won't actually work due to security restrictions
        alert(
          'Press F12 or right-click and select "Inspect Element" to open developer tools.'
        );
      }

      function viewSource() {
        window.open("view-source:" + location.href, "_blank");
      }

      // System Tools Functions
      let autoRefreshInterval = null;

      function clearAllData() {
        if (
          confirm("This will clear all data and refresh the page. Continue?")
        ) {
          localStorage.clear();
          sessionStorage.clear();
          if ("caches" in window) {
            caches.keys().then((names) => {
              names.forEach((name) => caches.delete(name));
            });
          }
          location.reload();
        }
      }

      function exportSettings() {
        const settings = {
          buttonOpacity: localStorage.getItem("buttonOpacity") || "100",
          adminLoggedIn: localStorage.getItem("adminLoggedIn") || "false",
          timestamp: new Date().toISOString(),
          version: "1.0",
        };

        const blob = new Blob([JSON.stringify(settings, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `phonehub-settings-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
      }

      function importSettings() {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = ".json";
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const settings = JSON.parse(e.target.result);
                if (settings.buttonOpacity) {
                  localStorage.setItem("buttonOpacity", settings.buttonOpacity);
                  document.getElementById("opacitySlider").value =
                    settings.buttonOpacity;
                  updateButtonOpacity();
                }
                alert("Settings imported successfully!");
              } catch (err) {
                alert("Error importing settings: " + err.message);
              }
            };
            reader.readAsText(file);
          }
        };
        input.click();
      }

      function systemMonitor() {
        const display = document.getElementById("monitorDisplay");
        display.style.display = "block";

        const updateMonitor = () => {
          const memory = performance.memory || {};
          const connection = navigator.connection || {};

          let info = "<strong>üìä System Monitor:</strong><br>";
          info += `Uptime: ${Math.round(performance.now() / 1000)} seconds<br>`;
          info += `Memory Used: ${Math.round(
            (memory.usedJSHeapSize || 0) / 1024 / 1024
          )} MB<br>`;
          info += `Memory Limit: ${Math.round(
            (memory.jsHeapSizeLimit || 0) / 1024 / 1024
          )} MB<br>`;
          info += `Connection: ${connection.effectiveType || "Unknown"}<br>`;
          info += `Battery: ${navigator.onLine ? "Online" : "Offline"}<br>`;
          info += `Last Updated: ${new Date().toLocaleTimeString()}`;

          display.innerHTML = info;
        };

        updateMonitor();
        const monitorInterval = setInterval(updateMonitor, 5000);

        // Stop monitoring after 30 seconds
        setTimeout(() => {
          clearInterval(monitorInterval);
          display.innerHTML +=
            "<br><small>Monitoring stopped. Click again to restart.</small>";
        }, 30000);
      }

      function setAutoRefresh() {
        const minutes = parseInt(document.getElementById("autoRefresh").value);
        if (minutes && minutes > 0) {
          if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
          }
          autoRefreshInterval = setInterval(() => {
            location.reload();
          }, minutes * 60000);
          alert(`Auto refresh set for every ${minutes} minute(s)`);
        } else {
          alert("Please enter a valid number of minutes");
        }
      }

      function emergencyReset() {
        if (
          confirm(
            "EMERGENCY RESET: This will clear everything and reload. Continue?"
          )
        ) {
          // Clear all data
          localStorage.clear();
          sessionStorage.clear();

          // Clear intervals
          if (autoRefreshInterval) clearInterval(autoRefreshInterval);

          // Reset to default state
          if (wakeLockSentinel) {
            wakeLockSentinel.release();
          }

          // Reload page
          location.reload();
        }
      }

      function downloadICS() {
        const title = (
          document.getElementById("title").value || "Event"
        ).replace(/\n/g, " ");
        const s = document.getElementById("whenStart").value;
        const e = document.getElementById("whenEnd").value;
        if (!s || !e) return alert("Select start and end times");
        const fmt = (d) =>
          d.replace(/[-:]/g, "").replace(".000", "").replace("Z", "") + "Z";
        const dtStart = new Date(s);
        const dtEnd = new Date(e);
        const ics = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//PhoneHub//EN
BEGIN:VEVENT
UID:${Date.now()}@phonehub
DTSTAMP:${fmt(new Date().toISOString())}
DTSTART:${fmt(dtStart.toISOString())}
DTEND:${fmt(dtEnd.toISOString())}
SUMMARY:${title}
END:VEVENT
END:VCALENDAR`;
        const blob = new Blob([ics], { type: "text/calendar" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `${title}.ics`;
        a.click();
        URL.revokeObjectURL(a.href);
      }
    </script>
  </body>
</html>
